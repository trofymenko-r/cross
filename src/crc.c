#include "crc.h"


/******************************************************************************/
/*  crc 16 Hdlc, iso 3309, x^16 + x^12 + x^5 + x^0, 0x8408, inverted                                                               */
/******************************************************************************/
#ifdef  Crc16Hdlc_Table
static const U16    au16Crc16HdlcTab_256[256] = {
        0x0000u, 0x1189u, 0x2312u, 0x329bu, 0x4624u, 0x57adu, 0x6536u, 0x74bfu,
        0x8c48u, 0x9dc1u, 0xaf5au, 0xbed3u, 0xca6cu, 0xdbe5u, 0xe97eu, 0xf8f7u,
        0x1081u, 0x0108u, 0x3393u, 0x221au, 0x56a5u, 0x472cu, 0x75b7u, 0x643eu,
        0x9cc9u, 0x8d40u, 0xbfdbu, 0xae52u, 0xdaedu, 0xcb64u, 0xf9ffu, 0xe876u,
        0x2102u, 0x308bu, 0x0210u, 0x1399u, 0x6726u, 0x76afu, 0x4434u, 0x55bdu,
        0xad4au, 0xbcc3u, 0x8e58u, 0x9fd1u, 0xeb6eu, 0xfae7u, 0xc87cu, 0xd9f5u,
        0x3183u, 0x200au, 0x1291u, 0x0318u, 0x77a7u, 0x662eu, 0x54b5u, 0x453cu,
        0xbdcbu, 0xac42u, 0x9ed9u, 0x8f50u, 0xfbefu, 0xea66u, 0xd8fdu, 0xc974u,
        0x4204u, 0x538du, 0x6116u, 0x709fu, 0x0420u, 0x15a9u, 0x2732u, 0x36bbu,
        0xce4cu, 0xdfc5u, 0xed5eu, 0xfcd7u, 0x8868u, 0x99e1u, 0xab7au, 0xbaf3u,
        0x5285u, 0x430cu, 0x7197u, 0x601eu, 0x14a1u, 0x0528u, 0x37b3u, 0x263au,
        0xdecdu, 0xcf44u, 0xfddfu, 0xec56u, 0x98e9u, 0x8960u, 0xbbfbu, 0xaa72u,
        0x6306u, 0x728fu, 0x4014u, 0x519du, 0x2522u, 0x34abu, 0x0630u, 0x17b9u,
        0xef4eu, 0xfec7u, 0xcc5cu, 0xddd5u, 0xa96au, 0xb8e3u, 0x8a78u, 0x9bf1u,
        0x7387u, 0x620eu, 0x5095u, 0x411cu, 0x35a3u, 0x242au, 0x16b1u, 0x0738u,
        0xffcfu, 0xee46u, 0xdcddu, 0xcd54u, 0xb9ebu, 0xa862u, 0x9af9u, 0x8b70u,
        0x8408u, 0x9581u, 0xa71au, 0xb693u, 0xc22cu, 0xd3a5u, 0xe13eu, 0xf0b7u,
        0x0840u, 0x19c9u, 0x2b52u, 0x3adbu, 0x4e64u, 0x5fedu, 0x6d76u, 0x7cffu,
        0x9489u, 0x8500u, 0xb79bu, 0xa612u, 0xd2adu, 0xc324u, 0xf1bfu, 0xe036u,
        0x18c1u, 0x0948u, 0x3bd3u, 0x2a5au, 0x5ee5u, 0x4f6cu, 0x7df7u, 0x6c7eu,
        0xa50au, 0xb483u, 0x8618u, 0x9791u, 0xe32eu, 0xf2a7u, 0xc03cu, 0xd1b5u,
        0x2942u, 0x38cbu, 0x0a50u, 0x1bd9u, 0x6f66u, 0x7eefu, 0x4c74u, 0x5dfdu,
        0xb58bu, 0xa402u, 0x9699u, 0x8710u, 0xf3afu, 0xe226u, 0xd0bdu, 0xc134u,
        0x39c3u, 0x284au, 0x1ad1u, 0x0b58u, 0x7fe7u, 0x6e6eu, 0x5cf5u, 0x4d7cu,
        0xc60cu, 0xd785u, 0xe51eu, 0xf497u, 0x8028u, 0x91a1u, 0xa33au, 0xb2b3u,
        0x4a44u, 0x5bcdu, 0x6956u, 0x78dfu, 0x0c60u, 0x1de9u, 0x2f72u, 0x3efbu,
        0xd68du, 0xc704u, 0xf59fu, 0xe416u, 0x90a9u, 0x8120u, 0xb3bbu, 0xa232u,
        0x5ac5u, 0x4b4cu, 0x79d7u, 0x685eu, 0x1ce1u, 0x0d68u, 0x3ff3u, 0x2e7au,
        0xe70eu, 0xf687u, 0xc41cu, 0xd595u, 0xa12au, 0xb0a3u, 0x8238u, 0x93b1u,
        0x6b46u, 0x7acfu, 0x4854u, 0x59ddu, 0x2d62u, 0x3cebu, 0x0e70u, 0x1ff9u,
        0xf78fu, 0xe606u, 0xd49du, 0xc514u, 0xb1abu, 0xa022u, 0x92b9u, 0x8330u,
        0x7bc7u, 0x6a4eu, 0x58d5u, 0x495cu, 0x3de3u, 0x2c6au, 0x1ef1u, 0x0f78u
        };
/*
VOID
Crc16HdlcCalcTable(
        IN  PU16    pu16CrcTable
        )
{
	for(int i=0; i<256; i++){
		pu16Data[i] = i;
		for(int j=0; j<8; j++)
            pu16Data[i] = ((pu16Data[i]&1)*0x8408)^(pu16Data[i]>>1);
   }
}*/

U16
Crc16HdlcCalc(
        IN  PU16    pu16Data,
        IN  U32     u32Bytes
        )
{
    PU8 pu8Data = (PU8)pu16Data;
    U16 u16Crc = 0xffffu;

    while(u32Bytes-- > 0u)
        u16Crc = au16Crc16HdlcTab_256[(u16Crc ^ *pu8Data++) & 0xffu] ^ (u16Crc>>8);
    
    return(u16Crc^0xffffu);
}
#else
U16
Crc16HdlcCalc(
        IN  PU16    pu16Data,
        IN  U32     u32Bytes
        )
{
    U16 u16Tmp;
    U16 u16Crc = 0xffffu;

    while(u32Bytes > 0u){
        u16Tmp  = (*pu16Data&0x00ffu) ^ (u16Crc & 0x00ffu);
        u16Tmp  = ((u16Tmp << 4) ^ u16Tmp) & 0x00ffu;
        u16Crc  = (u16Crc >> 8) ^ ((u16Tmp << 8) ^ (u16Tmp << 3) ^ (u16Tmp >> 4));
        u32Bytes--;
        if(u32Bytes == 0u)
            break;
        u16Tmp  = ((*pu16Data&0xff00u)>>8) ^ (u16Crc & 0x00ffu);
        u16Tmp  = ((u16Tmp << 4) ^ u16Tmp) & 0x00ffu;
        u16Crc  = (u16Crc >> 8) ^ ((u16Tmp << 8) ^ (u16Tmp << 3) ^ (u16Tmp >> 4));
        u32Bytes--;
        pu16Data++;
    }

    return(u16Crc^0xffff);
}
#endif  // Crc16Hdlc_Table

/******************************************************************************/
/*  crc 16 ccitt, x^16 + x^12 + x^5 + x^0, 0x1021                             */
/******************************************************************************/
#ifdef  Crc16Ccitt_Table
static const U16    au16Crc16CcittTab_256[256] = {
        0x0000u, 0x1021u, 0x2042u, 0x3063u, 0x4084u, 0x50a5u, 0x60c6u, 0x70e7u,
        0x8108u, 0x9129u, 0xa14au, 0xb16bu, 0xc18cu, 0xd1adu, 0xe1ceu, 0xf1efu,
        0x1231u, 0x0210u, 0x3273u, 0x2252u, 0x52b5u, 0x4294u, 0x72f7u, 0x62d6u,
        0x9339u, 0x8318u, 0xb37bu, 0xa35au, 0xd3bdu, 0xc39cu, 0xf3ffu, 0xe3deu,
        0x2462u, 0x3443u, 0x0420u, 0x1401u, 0x64e6u, 0x74c7u, 0x44a4u, 0x5485u,
        0xa56au, 0xb54bu, 0x8528u, 0x9509u, 0xe5eeu, 0xf5cfu, 0xc5acu, 0xd58du,
        0x3653u, 0x2672u, 0x1611u, 0x0630u, 0x76d7u, 0x66f6u, 0x5695u, 0x46b4u,
        0xb75bu, 0xa77au, 0x9719u, 0x8738u, 0xf7dfu, 0xe7feu, 0xd79du, 0xc7bcu,
        0x48c4u, 0x58e5u, 0x6886u, 0x78a7u, 0x0840u, 0x1861u, 0x2802u, 0x3823u,
        0xc9ccu, 0xd9edu, 0xe98eu, 0xf9afu, 0x8948u, 0x9969u, 0xa90au, 0xb92bu,
        0x5af5u, 0x4ad4u, 0x7ab7u, 0x6a96u, 0x1a71u, 0x0a50u, 0x3a33u, 0x2a12u,
        0xdbfdu, 0xcbdcu, 0xfbbfu, 0xeb9eu, 0x9b79u, 0x8b58u, 0xbb3bu, 0xab1au,
        0x6ca6u, 0x7c87u, 0x4ce4u, 0x5cc5u, 0x2c22u, 0x3c03u, 0x0c60u, 0x1c41u,
        0xedaeu, 0xfd8fu, 0xcdecu, 0xddcdu, 0xad2au, 0xbd0bu, 0x8d68u, 0x9d49u,
        0x7e97u, 0x6eb6u, 0x5ed5u, 0x4ef4u, 0x3e13u, 0x2e32u, 0x1e51u, 0x0e70u,
        0xff9fu, 0xefbeu, 0xdfddu, 0xcffcu, 0xbf1bu, 0xaf3au, 0x9f59u, 0x8f78u,
        0x9188u, 0x81a9u, 0xb1cau, 0xa1ebu, 0xd10cu, 0xc12du, 0xf14eu, 0xe16fu,
        0x1080u, 0x00a1u, 0x30c2u, 0x20e3u, 0x5004u, 0x4025u, 0x7046u, 0x6067u,
        0x83b9u, 0x9398u, 0xa3fbu, 0xb3dau, 0xc33du, 0xd31cu, 0xe37fu, 0xf35eu,
        0x02b1u, 0x1290u, 0x22f3u, 0x32d2u, 0x4235u, 0x5214u, 0x6277u, 0x7256u,
        0xb5eau, 0xa5cbu, 0x95a8u, 0x8589u, 0xf56eu, 0xe54fu, 0xd52cu, 0xc50du,
        0x34e2u, 0x24c3u, 0x14a0u, 0x0481u, 0x7466u, 0x6447u, 0x5424u, 0x4405u,
        0xa7dbu, 0xb7fau, 0x8799u, 0x97b8u, 0xe75fu, 0xf77eu, 0xc71du, 0xd73cu,
        0x26d3u, 0x36f2u, 0x0691u, 0x16b0u, 0x6657u, 0x7676u, 0x4615u, 0x5634u,
        0xd94cu, 0xc96du, 0xf90eu, 0xe92fu, 0x99c8u, 0x89e9u, 0xb98au, 0xa9abu,
        0x5844u, 0x4865u, 0x7806u, 0x6827u, 0x18c0u, 0x08e1u, 0x3882u, 0x28a3u,
        0xcb7du, 0xdb5cu, 0xeb3fu, 0xfb1eu, 0x8bf9u, 0x9bd8u, 0xabbbu, 0xbb9au,
        0x4a75u, 0x5a54u, 0x6a37u, 0x7a16u, 0x0af1u, 0x1ad0u, 0x2ab3u, 0x3a92u,
        0xfd2eu, 0xed0fu, 0xdd6cu, 0xcd4du, 0xbdaau, 0xad8bu, 0x9de8u, 0x8dc9u,
        0x7c26u, 0x6c07u, 0x5c64u, 0x4c45u, 0x3ca2u, 0x2c83u, 0x1ce0u, 0x0cc1u,
        0xef1fu, 0xff3eu, 0xcf5du, 0xdf7cu, 0xaf9bu, 0xbfbau, 0x8fd9u, 0x9ff8u,
        0x6e17u, 0x7e36u, 0x4e55u, 0x5e74u, 0x2e93u, 0x3eb2u, 0x0ed1u, 0x1ef0u
        };
/*
VOID
Crc16CcittCalcTable(
        IN  PU16    pu16CrcTable
        )
{
    for(U16 i=0; i<256u; i++){
        pu16CrcTable[i] = i << 8;
        for(U8 j=0; j<8u; j++){
            if(pu16CrcTable[i] & (1 << 15))
                pu16CrcTable[i] = (pu16CrcTable[i] << 1) ^ 0x1021u;
            else
                pu16CrcTable[i] = pu16CrcTable[i] << 1;
        }
    }
}*/

U16
Crc16CcittCalc(
        IN  PU16    pu16Data,
        IN  U32     u32Bytes
        )
{
    PU8 pu8Data = (PU8)pu16Data;
    U16 u16Crc = 0u;

    while(u32Bytes-- > 0u)
        u16Crc = au16Crc16CcittTab_256[((u16Crc>>8) ^ *pu8Data++) & 0xff] ^ (u16Crc<<8);
    
    return(u16Crc);
}
#else
U16
Crc16CcittCalc(
        IN  PU16    pu16Data,
        IN  U32     u32Bytes
        )
{
    U16 u16Crc = 0x0000u;

    while(u32Bytes > 0u){
        u16Crc  = (U8)(u16Crc >> 8) | (u16Crc << 8);
        u16Crc ^= ((*pu16Data)&0x00ffu);
        u16Crc ^= (U8)(u16Crc & 0xffu) >> 4;
        u16Crc ^= (u16Crc << 8) << 4;
        u16Crc ^= ((u16Crc & 0xffu) << 4) << 1;
        u32Bytes--;
        if(u32Bytes == 0u){
            break;
        }
        u16Crc  = (U8)(u16Crc >> 8) | (u16Crc << 8);
        u16Crc ^= (((*pu16Data)&0xff00u)>>8);
        u16Crc ^= (U8)(u16Crc & 0xffu) >> 4;
        u16Crc ^= (u16Crc << 8) << 4;
        u16Crc ^= ((u16Crc & 0xffu) << 4) << 1;
        u32Bytes--;
        pu16Data++;
    }

    return(u16Crc);
}
#endif  // Crc16Ccitt_Table

/******************************************************************************/
/*  crc 32                                                                    */
/******************************************************************************/
#ifdef  Crc32_Table
static const U32    au32Crc32Tab_256[256] = {
        0x00000000u, 0x77073096u, 0xEE0E612Cu, 0x990951BAu,
        0x076DC419u, 0x706AF48Fu, 0xE963A535u, 0x9E6495A3u,
        0x0EDB8832u, 0x79DCB8A4u, 0xE0D5E91Eu, 0x97D2D988u,
        0x09B64C2Bu, 0x7EB17CBDu, 0xE7B82D07u, 0x90BF1D91u,
        0x1DB71064u, 0x6AB020F2u, 0xF3B97148u, 0x84BE41DEu,
        0x1ADAD47Du, 0x6DDDE4EBu, 0xF4D4B551u, 0x83D385C7u,
        0x136C9856u, 0x646BA8C0u, 0xFD62F97Au, 0x8A65C9ECu,
        0x14015C4Fu, 0x63066CD9u, 0xFA0F3D63u, 0x8D080DF5u,
        0x3B6E20C8u, 0x4C69105Eu, 0xD56041E4u, 0xA2677172u,
        0x3C03E4D1u, 0x4B04D447u, 0xD20D85FDu, 0xA50AB56Bu,
        0x35B5A8FAu, 0x42B2986Cu, 0xDBBBC9D6u, 0xACBCF940u,
        0x32D86CE3u, 0x45DF5C75u, 0xDCD60DCFu, 0xABD13D59u,
        0x26D930ACu, 0x51DE003Au, 0xC8D75180u, 0xBFD06116u,
        0x21B4F4B5u, 0x56B3C423u, 0xCFBA9599u, 0xB8BDA50Fu,
        0x2802B89Eu, 0x5F058808u, 0xC60CD9B2u, 0xB10BE924u,
        0x2F6F7C87u, 0x58684C11u, 0xC1611DABu, 0xB6662D3Du,
        0x76DC4190u, 0x01DB7106u, 0x98D220BCu, 0xEFD5102Au,
        0x71B18589u, 0x06B6B51Fu, 0x9FBFE4A5u, 0xE8B8D433u,
        0x7807C9A2u, 0x0F00F934u, 0x9609A88Eu, 0xE10E9818u,
        0x7F6A0DBBu, 0x086D3D2Du, 0x91646C97u, 0xE6635C01u,
        0x6B6B51F4u, 0x1C6C6162u, 0x856530D8u, 0xF262004Eu,
        0x6C0695EDu, 0x1B01A57Bu, 0x8208F4C1u, 0xF50FC457u,
        0x65B0D9C6u, 0x12B7E950u, 0x8BBEB8EAu, 0xFCB9887Cu,
        0x62DD1DDFu, 0x15DA2D49u, 0x8CD37CF3u, 0xFBD44C65u,
        0x4DB26158u, 0x3AB551CEu, 0xA3BC0074u, 0xD4BB30E2u,
        0x4ADFA541u, 0x3DD895D7u, 0xA4D1C46Du, 0xD3D6F4FBu,
        0x4369E96Au, 0x346ED9FCu, 0xAD678846u, 0xDA60B8D0u,
        0x44042D73u, 0x33031DE5u, 0xAA0A4C5Fu, 0xDD0D7CC9u,
        0x5005713Cu, 0x270241AAu, 0xBE0B1010u, 0xC90C2086u,
        0x5768B525u, 0x206F85B3u, 0xB966D409u, 0xCE61E49Fu,
        0x5EDEF90Eu, 0x29D9C998u, 0xB0D09822u, 0xC7D7A8B4u,
        0x59B33D17u, 0x2EB40D81u, 0xB7BD5C3Bu, 0xC0BA6CADu,
        0xEDB88320u, 0x9ABFB3B6u, 0x03B6E20Cu, 0x74B1D29Au,
        0xEAD54739u, 0x9DD277AFu, 0x04DB2615u, 0x73DC1683u,
        0xE3630B12u, 0x94643B84u, 0x0D6D6A3Eu, 0x7A6A5AA8u,
        0xE40ECF0Bu, 0x9309FF9Du, 0x0A00AE27u, 0x7D079EB1u,
        0xF00F9344u, 0x8708A3D2u, 0x1E01F268u, 0x6906C2FEu,
        0xF762575Du, 0x806567CBu, 0x196C3671u, 0x6E6B06E7u,
        0xFED41B76u, 0x89D32BE0u, 0x10DA7A5Au, 0x67DD4ACCu,
        0xF9B9DF6Fu, 0x8EBEEFF9u, 0x17B7BE43u, 0x60B08ED5u,
        0xD6D6A3E8u, 0xA1D1937Eu, 0x38D8C2C4u, 0x4FDFF252u,
        0xD1BB67F1u, 0xA6BC5767u, 0x3FB506DDu, 0x48B2364Bu,
        0xD80D2BDAu, 0xAF0A1B4Cu, 0x36034AF6u, 0x41047A60u,
        0xDF60EFC3u, 0xA867DF55u, 0x316E8EEFu, 0x4669BE79u,
        0xCB61B38Cu, 0xBC66831Au, 0x256FD2A0u, 0x5268E236u,
        0xCC0C7795u, 0xBB0B4703u, 0x220216B9u, 0x5505262Fu,
        0xC5BA3BBEu, 0xB2BD0B28u, 0x2BB45A92u, 0x5CB36A04u,
        0xC2D7FFA7u, 0xB5D0CF31u, 0x2CD99E8Bu, 0x5BDEAE1Du,
        0x9B64C2B0u, 0xEC63F226u, 0x756AA39Cu, 0x026D930Au,
        0x9C0906A9u, 0xEB0E363Fu, 0x72076785u, 0x05005713u,
        0x95BF4A82u, 0xE2B87A14u, 0x7BB12BAEu, 0x0CB61B38u,
        0x92D28E9Bu, 0xE5D5BE0Du, 0x7CDCEFB7u, 0x0BDBDF21u,
        0x86D3D2D4u, 0xF1D4E242u, 0x68DDB3F8u, 0x1FDA836Eu,
        0x81BE16CDu, 0xF6B9265Bu, 0x6FB077E1u, 0x18B74777u,
        0x88085AE6u, 0xFF0F6A70u, 0x66063BCAu, 0x11010B5Cu,
        0x8F659EFFu, 0xF862AE69u, 0x616BFFD3u, 0x166CCF45u,
        0xA00AE278u, 0xD70DD2EEu, 0x4E048354u, 0x3903B3C2u,
        0xA7672661u, 0xD06016F7u, 0x4969474Du, 0x3E6E77DBu,
        0xAED16A4Au, 0xD9D65ADCu, 0x40DF0B66u, 0x37D83BF0u,
        0xA9BCAE53u, 0xDEBB9EC5u, 0x47B2CF7Fu, 0x30B5FFE9u,
        0xBDBDF21Cu, 0xCABAC28Au, 0x53B39330u, 0x24B4A3A6u,
        0xBAD03605u, 0xCDD70693u, 0x54DE5729u, 0x23D967BFu,
        0xB3667A2Eu, 0xC4614AB8u, 0x5D681B02u, 0x2A6F2B94u,
        0xB40BBE37u, 0xC30C8EA1u, 0x5A05DF1Bu, 0x2D02EF8Du
        };
/*
VOID
Crc32CalcTable(
        IN  PU32    pu32CrcTable
        )
{
    for(U16 i=0u; i<255u; i++){
        pu32CrcTable[i] = i;
        for(U8 j=0u; j<8u; j++)
            pu32CrcTable[i] = ((pu32CrcTable[i]&1)*0xedb88320u)^(pu32CrcTable[i]>>1);
    }
}*/

U32
Crc32Calc(
        IN  PVOID   pvData,
        IN  U32     u32Bytes
        )
{
    U32 u32Crc = 0xffffffffu;

    while(u32Bytes-- > 0u){
        u32Crc = (u32Crc>>8)^au32Crc32Tab_256[(u32Crc^*(PU8)pvData)&0xffu];
        pvData = (PU8)pvData + 1;
    }

    return(u32Crc^0xffffffffu);
}
#else
U32
Crc32Calc(
        IN  PVOID   pvData,
        IN  U32     u32Bytes
        )
{
    U32 u32Crc = 0xffffffffu;

    for(U32 i=0u; i<u32Bytes; i++){
        u32Crc ^= *(PU8)pvData;
        for(U8 j=0u; j<8u; j++)
            u32Crc = (u32Crc>>1)^((u32Crc&1)*0xedb88320u);
        pvData = (PU8)pvData + 1;
    }

    return(u32Crc^0xffffffffu);
}
#endif  // Crc32_Table

